"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6001],{3905:(e,t,s)=>{s.d(t,{Zo:()=>p,kt:()=>k});var n=s(7294);function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function l(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){a(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function o(e,t){if(null==e)return{};var s,n,a=function(e,t){if(null==e)return{};var s,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||(a[s]=e[s]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}var i=n.createContext({}),d=function(e){var t=n.useContext(i),s=t;return e&&(s="function"==typeof e?e(t):l(l({},t),e)),s},p=function(e){var t=d(e.components);return n.createElement(i.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var s=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=d(s),m=a,k=u["".concat(i,".").concat(m)]||u[m]||c[m]||r;return s?n.createElement(k,l(l({ref:t},p),{},{components:s})):n.createElement(k,l({ref:t},p))}));function k(e,t){var s=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=s.length,l=new Array(r);l[0]=m;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o[u]="string"==typeof e?e:a,l[1]=o;for(var d=2;d<r;d++)l[d]=s[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,s)}m.displayName="MDXCreateElement"},8900:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var n=s(7462),a=(s(7294),s(3905));const r={sidebar_position:1,tags:["Network","DNS","VPN"]},l="Network Tips",o={unversionedId:"network/network tips",id:"network/network tips",title:"Network Tips",description:"This section is a comprehensive guide to various topics related to Networking, including disabling IPv6, setting up DNS servers, VPN servers, and proxy servers. There are also topics on how to use different VPN services and redirect network traffic. This section provides in-depth information on how to configure different VPN protocols like OpenVPN, V2Ray, ShadowSocks, and WireGuard.",source:"@site/docs/network/network tips.md",sourceDirName:"network",slug:"/network/network tips",permalink:"/Wisdom-Hub/network/network tips",draft:!1,tags:[{label:"Network",permalink:"/Wisdom-Hub/tags/network"},{label:"DNS",permalink:"/Wisdom-Hub/tags/dns"},{label:"VPN",permalink:"/Wisdom-Hub/tags/vpn"}],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,tags:["Network","DNS","VPN"]},sidebar:"tutorialSidebar",previous:{title:"Network",permalink:"/Wisdom-Hub/network/"},next:{title:"SSH",permalink:"/Wisdom-Hub/network/ssh"}},i={},d=[{value:"Disable IPV6",id:"disable-ipv6",level:2},{value:"Setup DNS",id:"setup-dns",level:2},{value:"Using resolv.conf",id:"using-resolvconf",level:3},{value:"Using systemd",id:"using-systemd",level:3},{value:"DNS Server - dhclient",id:"dns-server---dhclient",level:3},{value:"Flush System Settings",id:"flush-system-settings",level:2},{value:"Open an application over socks",id:"open-an-application-over-socks",level:2},{value:"Setup DNS Server",id:"setup-dns-server",level:2},{value:"Using Systemd",id:"using-systemd-1",level:3},{value:"Using dnsmasq",id:"using-dnsmasq",level:3},{value:"Outline Proxy Server + Jump Server",id:"outline-proxy-server--jump-server",level:2},{value:"Initialization",id:"initialization",level:3},{value:"Outline Server",id:"outline-server",level:3},{value:"Jump server",id:"jump-server",level:3},{value:"With IPTables",id:"with-iptables",level:4},{value:"Using SSH Forward",id:"using-ssh-forward",level:4},{value:"Using socat",id:"using-socat",level:4},{value:"Optimization",id:"optimization",level:4},{value:"Fake Traffic script",id:"fake-traffic-script",level:4},{value:"Client-Side",id:"client-side",level:3},{value:"ShadowSocks Json config example ( rust )",id:"shadowsocks-json-config-example--rust-",level:4},{value:"ShadowSocks SS URL Format",id:"shadowsocks-ss-url-format",level:4},{value:"Redirecting the whole network traffic",id:"redirecting-the-whole-network-traffic",level:2},{value:"Proxy udp traffic from ssh",id:"proxy-udp-traffic-from-ssh",level:2},{value:"Set System-wide DNS",id:"set-system-wide-dns",level:2},{value:"Shekan DNS",id:"shekan-dns",level:3},{value:"403 DNS",id:"403-dns",level:3},{value:"electrotm DNS",id:"electrotm-dns",level:3},{value:"OpenDns",id:"opendns",level:3},{value:"Global DNS",id:"global-dns",level:3},{value:"Setting domains directly in /etc/hosts",id:"setting-domains-directly-in-etchosts",level:3},{value:"Simple python http.server",id:"simple-python-httpserver",level:2}],p={toc:d},u="wrapper";function c(e){let{components:t,...s}=e;return(0,a.kt)(u,(0,n.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"network-tips"},"Network Tips"),(0,a.kt)("p",null,"This section is a comprehensive guide to various topics related to Networking, including disabling IPv6, setting up DNS servers, VPN servers, and proxy servers. There are also topics on how to use different VPN services and redirect network traffic. This section provides in-depth information on how to configure different VPN protocols like OpenVPN, V2Ray, ShadowSocks, and WireGuard."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#disable-ipv6"},"Disable IPV6")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#setup-dns"},"Setup DNS"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#using-resolvconf"},"Using resolv.conf")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#using-systemd"},"Using systemd")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#dns-server---dhclient"},"DNS Server - dhclient")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#flush-system-settings"},"Flush System Settings")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#open-an-application-over-socks"},"Open an application over socks")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#setup-dns-server"},"Setup DNS Server"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#using-systemd-1"},"Using Systemd")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#using-dnsmasq"},"Using dnsmasq")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#outline-proxy-server--jump-server"},"Outline Proxy Server + Jump Server"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#initialization"},"Initialization")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#outline-server"},"Outline Server")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#jump-server"},"Jump server"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#with-iptables"},"With IPTables")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#using-ssh-forward"},"Using SSH Forward")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#using-socat"},"Using socat")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#optimization"},"Optimization")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#fake-traffic-script"},"Fake Traffic script")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#client-side"},"Client-Side"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#shadowsocks-json-config-example--rust-"},"ShadowSocks Json config example ( rust )")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#shadowsocks-ss-url-format"},"ShadowSocks SS URL Format")))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#redirecting-the-whole-network-traffic"},"Redirecting the whole network traffic")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#proxy-udp-traffic-from-ssh"},"Proxy udp traffic from ssh")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#set-system-wide-dns"},"Set System-wide DNS"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#shekan-dns"},"Shekan DNS")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#403-dns"},"403 DNS")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#electrotm-dns"},"electrotm DNS")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#opendns"},"OpenDns")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#global-dns"},"Global DNS")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#setting-domains-directly-in-etchosts"},"Setting domains directly in /etc/hosts")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#simple-python-httpserver"},"Simple python http.server"))),(0,a.kt)("h2",{id:"disable-ipv6"},"Disable IPV6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/sysctl.conf\n\nnet.ipv6.conf.all.disable_ipv6=1\nnet.ipv6.conf.default.disable_ipv6=1\n\nsudo sysctl -p \n")),(0,a.kt)("h2",{id:"setup-dns"},"Setup DNS"),(0,a.kt)("h3",{id:"using-resolvconf"},"Using resolv.conf"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'sudo nano /etc/resolv.conf\nnameserver 1.1.1.1\nnameserver 1.0.0.1\nnameserver 208.67.222.222\nnameserver 208.67.220.220\nnameserver 8.8.8.8\nnameserver 8.8.4.4\n\n# echo "nameserver 8.8.8.8" > /etc/resolv.conf\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl enable resolvconf\nsudo nano /etc/resolvconf/resolv.conf.d/head\nsudo nano /etc/resolvconf/resolv.conf.d/base\nnameserver 1.1.1.1\nnameserver 208.67.222.222\nnameserver 208.67.220.220\nnameserver 8.8.8.8\n")),(0,a.kt)("h3",{id:"using-systemd"},"Using systemd"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/systemd/resolved.conf\n[Resolve]\nDNS=1.1.1.1 208.67.222.222 208.67.220.220 8.8.8.8\n\nsudo nano /run/systemd/resolve/stub-resolv.conf\nnameserver 1.1.1.1\nnameserver 208.67.222.222\nnameserver 208.67.220.220\nnameserver 8.8.8.8\n\nsudo systemctl enable systemd-resolved\nsudo systemctl restart systemd-resolved\n\n# resolvectl dns enp3s0 1.1.1.1 \n# resolvectl dns enp1s0f0u6 1.1.1.1\nresolvectl dns\n")),(0,a.kt)("h3",{id:"dns-server---dhclient"},"DNS Server - dhclient"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/dhcp/dhclient.conf\nprepend domain-name-servers 208.67.222.222, 208.67.220.220, 8.8.8.8\n\nsudo nano /etc/network/interfaces\niface eth0 inet static\n  dns-nameservers 208.67.222.222 208.67.220.220 8.8.8.8\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"resolvectl dns eth0 # make sure dns is set\n# permanent? \n")),(0,a.kt)("h2",{id:"flush-system-settings"},"Flush System Settings"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo killall sslocal winedevice.exe wineserver services.exe EpicGamesLaunch EpicWebHelper.e explorer.exe lutris-wrapper:;\nsudo killall steamwebhelper gitstatusd steam;\nsudo killall -9 sslocal winedevice.exe wineserver services.exe EpicGamesLaunch EpicWebHelper.e explorer.exe lutris-wrapper:;\nsudo killall -9 steamwebhelper gitstatusd steam;\npkill -f -e -c lutris-wrapper;\npkill -f -e -c lutris;\npkill -f -e -c wine;\npkill -f -e -c steam;\npkill -f -e -c sslocal;\nsudo systemctl stop shadowsocks-rust-local@config;\n\nsudo systemd-resolve --flush-caches;\nsudo resolvectl flush-caches;\nsudo ip link delete tun0;\nsudo wg-quick down wg0;\nsudo systemctl daemon-reload;\nsudo ip route flush table main;\nsudo iptables --flush;\nsudo systemctl restart network;\nsudo systemctl restart NetworkManager;\nsudo sysctl -p;\n\nsudo systemctl restart shadowsocks-rust-local@config;\nsync; echo 3 > /proc/sys/vm/drop_caches;\n")),(0,a.kt)("h2",{id:"open-an-application-over-socks"},"Open an application over socks"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"torsocks deluge\ntsokcs deluge\n")),(0,a.kt)("h2",{id:"setup-dns-server"},"Setup DNS Server"),(0,a.kt)("h3",{id:"using-systemd-1"},"Using Systemd"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/systemd/resolved.conf\n[Resolve]\nDNS=1.1.1.1 9.9.9.9#dns.quad9.net 8.8.8.8\nFallbackDNS=208.67.222.222 208.67.220.220\n#Domains=\n#LLMNR=no\n#MulticastDNS=no\nDNSSEC=yes\nDNSOverTLS=no\nCache=yes        \nDNSStubListener=yes\nReadEtcHosts=yes\n\nsudo systemctl enable systemd-resolved.service\nsudo systemctl restart systemd-resolved.service\nsudo systemctl restart NetworkManager\n")),(0,a.kt)("h3",{id:"using-dnsmasq"},"Using dnsmasq"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install dnsmasq\n")),(0,a.kt)("h2",{id:"outline-proxy-server--jump-server"},"Outline Proxy Server + Jump Server"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Server: NetherLand"),(0,a.kt)("li",{parentName:"ul"},"OS: Ubuntu 22.04")),(0,a.kt)("h3",{id:"initialization"},"Initialization"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"ssh root@51.89.88.80\npasswd\nadduser mlibre\n\napt update\napt dist-upgrade\napt install htop sudo psmisc net-tools curl ntpdate\nsudo apt purge snapd ufw\nsudo apt autoremove --purge\nsudo ntpdate time.nist.gov\n\nnano /etc/sudoers\nmlibre  ALL=(ALL:ALL) NOPASSWD: ALL\n\nnano /etc/hosts\n127.0.0.1 mlibre\n\nsudo systemctl disable rsyslog\nsudo systemctl disable apparmor.service\nsudo systemctl disable systemd-journald\nsudo systemctl disable apport-autoreport.path\nsudo systemctl disable apport-forward.socket\n\n# CTRL +D\nssh-keygen\nssh-copy-id -i ~/.ssh/id_rsa.pub mlibre@51.89.88.80\n# ssh-copy-id -i ~/.ssh/id_rsa.pub -p 2138 mlibre@87.107.164.69\nssh mlibre@51.89.88.80\n\nsu\nssh-keygen\nssh-copy-id -i ~/.ssh/id_rsa.pub root@51.89.88.80\n\n## Both server and client\nsudo nano /etc/ssh/sshd_config\nPermitTunnel yes\n# ClientAliveInterval 300\n# ClientAliveCountMax 6\nTCPKeepAlive yes\nAllowAgentForwarding yes\nAllowTcpForwarding yes\nPermitTunnel yes\nGatewayPorts yes\n\nsudo systemctl daemon-reload\nsudo systemctl restart sshd\nsudo systemctl status sshd\n\nsudo nano /etc/sysctl.conf\nnet.ipv4.ip_forward=1\nnet.ipv4.tcp_fastopen=3\nfs.file-max = 5000000\n\nsudo sysctl -p\n\nsudo nano /etc/resolv.conf\nnameserver 1.1.1.1      \nnameserver 208.67.222.222\nnameserver 208.67.220.220\nnameserver 8.8.8.8\n\nsudo ufw allow 9090/udp\nsudo ufw allow 9090/tcp\nsudo ufw allow 9090\nsudo ufw allow OpenSSH\nsudo ufw allow dns\nsudo ufw allow 5353/tcp\nsudo ufw allow 5353/udp\nsudo ufw allow 443/tcp\nsudo ufw allow https\nsudo ufw allow ssh\nsudo ufw allow www\nsudo ufw allow bootps\n\nsudo ufw disable\nsudo systemctl enable ufw\nsudo ufw enable\nsudo systemctl restart ufw\nsudo systemctl status ufw\nsudo ufw status\n")),(0,a.kt)("h3",{id:"outline-server"},"Outline Server"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Download outline manager in your local linux system")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",{parentName:"p",href:"https://getoutline.org/get-started/#step-1"},"https://getoutline.org/get-started/#step-1"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Run and follow instructions")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Save the credentials"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'...\n{"apiUrl":"https://41.249.49.191:13108/112-XA1EFIGPw","certSha256":"121"}\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"In server: open ssh, https and other ports + ports mentioned in outline manager settings:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"  sudo ufw allow 51449\n  sudo ufw allow 51449/tcp\n  sudo ufw allow 51449/udp\n  sudo ufw allow 64920\n  sudo ufw allow 64920/udp\n  sudo ufw allow 64920/tcp\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Open Manager")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Create keys")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Share keys"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Keys are like this\nss://BASE64 STRING@IP:PORT/?outline=1\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"You can also open keys with ShadowSocks")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Run ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/teddysun/across/blob/master/bbr.sh"},"BBR script")))),(0,a.kt)("h3",{id:"jump-server"},"Jump server"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"SSHD configs:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/ssh/sshd_config\nAllowAgentForwarding yes\nAllowTcpForwarding yes\nTCPKeepAlive yes\nPermitTunnel yes\nGatewayPorts yes\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"SysCtl Settings:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/sysctl.conf\nnet.ipv4.tcp_fastopen=3\nnet.ipv4.ip_forward=1\n\nsudo sysctl -p\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/teddysun/across/blob/master/bbr.sh"},"BBR script"))),(0,a.kt)("h4",{id:"with-iptables"},"With IPTables"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install iptables-persistent\nsudo nano /etc/iptables/rules.v4\n\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\nCOMMIT\n*nat\n:PREROUTING ACCEPT [18895:9137441]\n:INPUT ACCEPT [6852:1538364]\n:OUTPUT ACCEPT [31:7269]\n:POSTROUTING ACCEPT [31:7269]\n\n-A PREROUTING -d 87.107.164.69/32 -p udp -m udp --dport 67 -j DNAT --to-destination 46.249.49.193:443\n-A PREROUTING -d 87.107.164.69/32 -p tcp -m tcp --dport 67 -j DNAT --to-destination 46.249.49.193:443\n\n-A PREROUTING -d 87.107.164.69/32 -p udp -m udp --dport 34964 -j DNAT --to-destination 46.249.49.193:34964\n-A PREROUTING -d 87.107.164.69/32 -p tcp -m tcp --dport 34964 -j DNAT --to-destination 46.249.49.193:34964\n\n#-A PREROUTING -p tcp -m tcp --dport 64921 -j DNAT --to-destination 46.249.49.193:64920\n#-A PREROUTING -p udp -m udp --dport 64921 -j DNAT --to-destination 46.249.49.193:64920\n#-A PREROUTING -p tcp -m tcp --dport 22055 -j DNAT --to-destination 46.249.49.193:22054\n#-A PREROUTING -p udp -m udp --dport 22055 -j DNAT --to-destination 46.249.49.193:22054\n-A POSTROUTING -j MASQUERADE\nCOMMIT\n\nsudo systemctl enable netfilter-persistent.service\nsudo systemctl restart netfilter-persistent.service\n")),(0,a.kt)("h4",{id:"using-ssh-forward"},"Using SSH Forward"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Client -> A (Jump Server) -> B (Outline Server)")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Install shadowSocks in Server B"),(0,a.kt)("li",{parentName:"ul"},"Run following commands in server A")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Server A IP: 87.107.164.69\n# Server A SSH Port: 2138\n# Server B IP: 46.249.49.193\n# Server B SSH Port: 56777\n# Server B ShadowSocks/Outline ports: 64920, 56777, 51449\n# ufw allow ......\nssh-copy-id -i ~/.ssh/id_rsa.pub mlibre@46.249.49.193 -p 56777\nsudo ssh-copy-id -i /root/.ssh/id_rsa.pub root@46.249.49.193 -p 56777\n\nssh -N -L 0.0.0.0:64920:46.249.49.193:64920 mlibre@46.249.49.193 -p 56777\n#                 APort BIP           BPort       BIP               BSSHPort\n")),(0,a.kt)("h4",{id:"using-socat"},"Using socat"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo socat -dd TCP4-LISTEN:8000,fork TCP4:Shadowsocks-server-ip:9000\nsudo socat -dd UDP-LISTEN:8000,fork UDP:Shadowsocks-server-ip:9000\n")),(0,a.kt)("h4",{id:"optimization"},"Optimization"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/shadowsocks/shadowsocks/wiki/Optimizing-Shadowsocks"},"https://github.com/shadowsocks/shadowsocks/wiki/Optimizing-Shadowsocks")),(0,a.kt)("h4",{id:"fake-traffic-script"},"Fake Traffic script"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("a",{parentName:"p",href:"https://github.com/malkemit/namizun"},"namizun"))),(0,a.kt)("h3",{id:"client-side"},"Client-Side"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"SSHD configs:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/ssh/sshd_config\nAllowAgentForwarding yes\nAllowTcpForwarding yes\nTCPKeepAlive yes\nPermitTunnel yes\nGatewayPorts yes\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"SysCtl Settings:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/sysctl.conf\nnet.ipv4.tcp_fastopen=3\nnet.ipv4.ip_forward=1\n\nsudo sysctl -p\n")),(0,a.kt)("h4",{id:"shadowsocks-json-config-example--rust-"},"ShadowSocks Json config example ( rust )"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "servers": [\n      {\n          "address": "87.107.164.69", // Server A IP Address\n          "port": 64920,\n          "password": "password", // Extracted OUTLINE Key Information\n          "method":"chacha20-ietf-poly1305", // Extracted OUTLINE Key Information\n          "timeout": 86400\n      }\n    ],\n    "mode":"tcp_and_udp",\n    "local_port":1080,\n    "local_address": "127.0.0.1",\n    "fast_open": true\n}\n')),(0,a.kt)("h4",{id:"shadowsocks-ss-url-format"},"ShadowSocks SS URL Format"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'sslocal --server-url "ss://dsadsadasda@11.11.49.193:11111" --local-addr "127.0.0.1:1080"\n')),(0,a.kt)("h2",{id:"redirecting-the-whole-network-traffic"},"Redirecting the whole network traffic"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ip route add 192.168.1.0/24 dev ppp0\n# ppp0: vpn name\n# 192.168.1.0: IP range\n")),(0,a.kt)("h2",{id:"proxy-udp-traffic-from-ssh"},"Proxy udp traffic from ssh"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://superuser.com/questions/53103/udp-traffic-through-ssh-tunnel"},"https://superuser.com/questions/53103/udp-traffic-through-ssh-tunnel")),(0,a.kt)("h2",{id:"set-system-wide-dns"},"Set System-wide DNS"),(0,a.kt)("h3",{id:"shekan-dns"},"Shekan DNS"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'# resolvectl query identitytoolkit.googleapis.com\nDNS_SERVER="178.22.122.100"\nsudo sh -c "echo nameserver $DNS_SERVER > /etc/resolv.conf"\nsudo sed -i \'/^\\s*#*DNS=/d\' /etc/systemd/resolved.conf && sudo sed -i \'$ a\\DNS=\'"$DNS_SERVER" /etc/systemd/resolved.conf\nsudo systemctl daemon-reload; wait;\nsudo systemctl restart systemd-networkd; wait;\nsudo systemctl restart systemd-resolved; wait;\nsudo systemd-resolve --flush-caches\nsudo resolvectl flush-caches\nsudo resolvectl dns eth0 "$DNS_SERVER"\nsudo resolvectl dns tun0 "$DNS_SERVER"\nsudo resolvectl dns enp3s0 "$DNS_SERVER"\nsudo resolvectl dns enp5s0 "$DNS_SERVER"\nsudo resolvectl dns docker0 "$DNS_SERVER"\nsudo resolvectl dns\n')),(0,a.kt)("h3",{id:"403-dns"},"403 DNS"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'DNS_SERVER="10.202.10.102"\nsudo sh -c "echo nameserver $DNS_SERVER > /etc/resolv.conf"\nsudo sed -i \'/^\\s*#*DNS=/d\' /etc/systemd/resolved.conf && sudo sed -i \'$ a\\DNS=\'"$DNS_SERVER" /etc/systemd/resolved.conf\nsudo systemctl daemon-reload; wait;\nsudo systemctl restart systemd-networkd; wait;\nsudo systemctl restart systemd-resolved; wait;\nsudo systemd-resolve --flush-caches\nsudo resolvectl flush-caches\nsudo resolvectl dns eth0 "$DNS_SERVER"\nsudo resolvectl dns tun0 "$DNS_SERVER"\nsudo resolvectl dns enp3s0 "$DNS_SERVER"\nsudo resolvectl dns enp5s0 "$DNS_SERVER"\nsudo resolvectl dns docker0 "$DNS_SERVER"\nsudo resolvectl dns\n')),(0,a.kt)("h3",{id:"electrotm-dns"},"electrotm DNS"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'DNS_SERVER="78.157.42.101"\nsudo sh -c "echo nameserver $DNS_SERVER > /etc/resolv.conf"\nsudo sed -i \'/^\\s*#*DNS=/d\' /etc/systemd/resolved.conf && sudo sed -i \'$ a\\DNS=\'"$DNS_SERVER" /etc/systemd/resolved.conf\nsudo systemctl daemon-reload; wait;\nsudo systemctl restart systemd-networkd; wait;\nsudo systemctl restart systemd-resolved; wait;\nsudo systemd-resolve --flush-caches\nsudo resolvectl flush-caches\nsudo resolvectl dns eth0 "$DNS_SERVER"\nsudo resolvectl dns tun0 "$DNS_SERVER"\nsudo resolvectl dns enp3s0 "$DNS_SERVER"\nsudo resolvectl dns enp5s0 "$DNS_SERVER"\nsudo resolvectl dns docker0 "$DNS_SERVER"\nsudo resolvectl dns\n')),(0,a.kt)("h3",{id:"opendns"},"OpenDns"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'DNS_SERVER="208.67.222.222"\nsudo sh -c "echo nameserver $DNS_SERVER > /etc/resolv.conf"\nsudo sed -i \'/^\\s*#*DNS=/d\' /etc/systemd/resolved.conf && sudo sed -i \'$ a\\DNS=\'"$DNS_SERVER" /etc/systemd/resolved.conf\nsudo systemctl daemon-reload; wait;\nsudo systemctl restart systemd-networkd; wait;\nsudo systemctl restart systemd-resolved; wait;\nsudo systemd-resolve --flush-caches\nsudo resolvectl flush-caches\nsudo resolvectl dns eth0 "$DNS_SERVER"\nsudo resolvectl dns tun0 "$DNS_SERVER"\nsudo resolvectl dns enp3s0 "$DNS_SERVER"\nsudo resolvectl dns enp5s0 "$DNS_SERVER"\nsudo resolvectl dns docker0 "$DNS_SERVER"\nsudo resolvectl dns\n')),(0,a.kt)("h3",{id:"global-dns"},"Global DNS"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'DNS_SERVER="1.1.1.1"\nsudo sh -c "echo nameserver $DNS_SERVER > /etc/resolv.conf"\nsudo sed -i \'/^\\s*#*DNS=/d\' /etc/systemd/resolved.conf && sudo sed -i \'$ a\\DNS=\'"$DNS_SERVER" /etc/systemd/resolved.conf\nsudo systemctl daemon-reload; wait;\nsudo systemctl restart systemd-networkd; wait;\nsudo systemctl restart systemd-resolved; wait;\nsudo systemd-resolve --flush-caches\nsudo resolvectl flush-caches\nsudo resolvectl dns eth0 "$DNS_SERVER"\nsudo resolvectl dns tun0 "$DNS_SERVER"\nsudo resolvectl dns enp3s0 "$DNS_SERVER"\nsudo resolvectl dns enp5s0 "$DNS_SERVER"\nsudo resolvectl dns docker0 "$DNS_SERVER"\nsudo resolvectl dns\n')),(0,a.kt)("h3",{id:"setting-domains-directly-in-etchosts"},"Setting domains directly in /etc/hosts"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/hosts\n\n10.202.10.4 securetoken.googleapis.com\n50.7.87.84  identitytoolkit.googleapis.com\n50.7.87.84  bard.google.com\n50.7.85.222 openai.com\n50.7.85.220 chat.openai.com\n50.7.87.85  cdn.openai.com\n188.68.52.244 www.bing.com\n50.7.87.85  marketplace.visualstudio.com\n50.7.85.222 auth0.openai.com\n50.7.85.218 api.codium.ai\n")),(0,a.kt)("h2",{id:"simple-python-httpserver"},"Simple python http.server"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"python3 -m http.server --bind 0.0.0.0 --cgi 8000\n")))}c.isMDXComponent=!0}}]);